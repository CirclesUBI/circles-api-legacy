# Circles Api [![Chat Server](https://chat.joincircles.net/api/v1/shield.svg?type=online&name=circles%20chat)](https://chat.joincircles.net) [![Backers](https://opencollective.com/circles/supporters/badge.svg)](https://opencollective.com/circles) [![Follow Circles](https://img.shields.io/twitter/follow/circlesubi.svg?label=follow+circles)](https://twitter.com/CirclesUBI) [![Circles License](https://img.shields.io/badge/license-APGLv3-orange.svg)](https://github.com/CirclesUBI/circles-api/blob/dev/LICENSE)


This holds the offchain components of the Circles API

## Setup

```sh
# clone and set up submodules
git clone
git submodule update --init

# install
npm install

# install contracts
cd contracts
npm install

# set up blockchain
npm run ganache

# deploy contracts
npx truffle compile
  npx truffle migrate --reset --compile-all

# use truffle console
npx truffle console
> let hf = await HubFactory.deployed()
> let s = await hf.spawn(1736111111111111, 0, 18, 'CRC', 3600, 100)
```

## Development

```ssh
// hotreloading should work
npm run dev
```

## Env Vars
Get in touch with @ana0 or @edzillion to get these env vars.

```ssh
# General
LOG_LEVEL=debug
NODE_ENV=test
API_VERSION=v1.1.2

# Cognito
COGNITO_POOL_ID=
COGNITO_POOL_REGION=
COGNITO_CLIENT_ID_API=
COGNITO_CLIENT_ID_MOBILE=
COGNITO_TEST_USERNAME=
COGNITO_TEST_PASSWORD=
COGNITO_POOL_JWT_KID=
COGNITO_POOL_JWT_N=

# SNS
ANDROID_GCM_PLATFORM_ARN=

# Database
PGUSER=
PGPASSWORD=
PGHOST=
PGPORT=
PGDATABASE=

# Blockchain
NETWORK_ID=
HUB_CONTRACT_ADDRESS=
PRIVATE_KEY=

# For scripts
AWS_REGION=
AWS_ACCESS_KEY_ID=
AWS_SECRET_ACCESS_KEY=
AUTH_ACCESS_TOKEN= //generated by saveCognitoTokenToEnvFile.js
```

## Authentication

Api authenication is managed by `accesstoken` sent in the response headers
`npm run token` will generate a valid token

-------------
